{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/gabri/Desktop/dogs-project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/gabri/Desktop/dogs-project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/gabri/Desktop/dogs-project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from\"react\";import{useNavigate}from\"react-router-dom\";import{GET_USER,TOKEN_POST}from\"./api\";import{jsx as _jsx}from\"react/jsx-runtime\";export var UserContext=/*#__PURE__*/React.createContext();export var UserStorage=function UserStorage(_ref){var children=_ref.children;var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),data=_React$useState2[0],setData=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),login=_React$useState4[0],setLogin=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),loading=_React$useState6[0],setLoading=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),error=_React$useState8[0],setError=_React$useState8[1];var nav=useNavigate();var logout=React.useCallback(function(){setData(null);setLogin(false);setLoading(false);setError(null);window.localStorage.removeItem(\"token\");nav(\"/login\");},[nav]);function getUser(_x){return _getUser.apply(this,arguments);}function _getUser(){_getUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(token){var _GET_USER2,url,options,response,json;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_GET_USER2=GET_USER(token),url=_GET_USER2.url,options=_GET_USER2.options;_context2.next=3;return fetch(url,options);case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:json=_context2.sent;setData(json);setLogin(true);case 9:case\"end\":return _context2.stop();}}},_callee2);}));return _getUser.apply(this,arguments);}function loginUser(_x2,_x3){return _loginUser.apply(this,arguments);}function _loginUser(){_loginUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(username,password){var _TOKEN_POST,url,options,response,_yield$response$json,token;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setError(null);setLoading(true);_TOKEN_POST=TOKEN_POST({username:username,password:password}),url=_TOKEN_POST.url,options=_TOKEN_POST.options;_context3.next=6;return fetch(url,options);case 6:response=_context3.sent;if(response.ok){_context3.next=9;break;}throw new Error(\"Erro: \".concat(response.statusText));case 9:_context3.next=11;return response.json();case 11:_yield$response$json=_context3.sent;token=_yield$response$json.token;window.localStorage.setItem(\"token\",token);_context3.next=16;return getUser(token);case 16:_context3.next=22;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](0);setError(_context3.t0.message);setLogin(false);case 22:_context3.prev=22;setLoading(false);return _context3.finish(22);case 25:case\"end\":return _context3.stop();}}},_callee3,null,[[0,18,22,25]]);}));return _loginUser.apply(this,arguments);}React.useEffect(function(){function autoLogin(){return _autoLogin.apply(this,arguments);}function _autoLogin(){_autoLogin=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var token,_GET_USER,url,options,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:token=window.localStorage.getItem(\"token\");if(!token){_context.next=24;break;}_context.prev=2;setError(null);setLoading(true);_GET_USER=GET_USER(token),url=_GET_USER.url,options=_GET_USER.options;_context.next=8;return fetch(url,options);case 8:response=_context.sent;if(response.ok){_context.next=11;break;}throw new Error(\"Token inválido\");case 11:_context.next=13;return getUser(token);case 13:_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](2);setError(_context.t0.message);logout();case 19:_context.prev=19;setLoading(false);return _context.finish(19);case 22:_context.next=25;break;case 24:setLogin(false);case 25:case\"end\":return _context.stop();}}},_callee,null,[[2,15,19,22]]);}));return _autoLogin.apply(this,arguments);}autoLogin();},[logout]);return/*#__PURE__*/_jsx(UserContext.Provider,{value:{loginUser:loginUser,logout:logout,data:data,login:login,loading:loading,error:error},children:children});};","map":{"version":3,"names":["React","useNavigate","GET_USER","TOKEN_POST","UserContext","createContext","UserStorage","children","useState","data","setData","login","setLogin","loading","setLoading","error","setError","nav","logout","useCallback","window","localStorage","removeItem","getUser","token","url","options","fetch","response","json","loginUser","username","password","ok","Error","statusText","setItem","message","useEffect","autoLogin","getItem"],"sources":["C:/Users/gabri/Desktop/dogs-project/src/UserContext.js"],"sourcesContent":["import React from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { GET_USER, TOKEN_POST } from \"./api\";\r\n\r\nexport const UserContext = React.createContext();\r\nexport const UserStorage = ({ children }) => {\r\n  const [data, setData] = React.useState(null);\r\n  const [login, setLogin] = React.useState(null);\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [error, setError] = React.useState(null);\r\n  const nav = useNavigate();\r\n\r\n  const logout = React.useCallback(() => {\r\n    setData(null);\r\n    setLogin(false);\r\n    setLoading(false);\r\n    setError(null);\r\n    window.localStorage.removeItem(\"token\");\r\n    nav(\"/login\");\r\n  }, [nav]);\r\n\r\n  async function getUser(token) {\r\n    const { url, options } = GET_USER(token);\r\n    const response = await fetch(url, options);\r\n    const json = await response.json();\r\n    setData(json);\r\n    setLogin(true);\r\n  }\r\n\r\n  async function loginUser(username, password) {\r\n    try {\r\n      setError(null);\r\n      setLoading(true);\r\n      const { url, options } = TOKEN_POST({ username, password });\r\n      const response = await fetch(url, options);\r\n      if (!response.ok) throw new Error(`Erro: ${response.statusText}`);\r\n      const { token } = await response.json();\r\n      window.localStorage.setItem(\"token\", token);\r\n      await getUser(token);\r\n    } catch (err) {\r\n      setError(err.message);\r\n      setLogin(false);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    async function autoLogin() {\r\n      const token = window.localStorage.getItem(\"token\");\r\n      if (token) {\r\n        try {\r\n          setError(null);\r\n          setLoading(true);\r\n          const { url, options } = GET_USER(token);\r\n          const response = await fetch(url, options);\r\n          if (!response.ok) throw new Error(\"Token inválido\");\r\n          await getUser(token);\r\n        } catch (err) {\r\n          setError(err.message);\r\n          logout();\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      } else {\r\n        setLogin(false);\r\n      }\r\n    }\r\n    autoLogin();\r\n  }, [logout]);\r\n\r\n  return (\r\n    <UserContext.Provider\r\n      value={{ loginUser, logout, data, login, loading, error }}\r\n    >\r\n      {children}\r\n    </UserContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}